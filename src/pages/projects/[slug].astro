---
import { getCollection, render, type CollectionEntry } from "astro:content";

import MainLayout from "@/layouts/MainLayout.astro";
import createSlug from "@/lib/createSlug";
import TableOfContents from "@/components/TableOfContents.astro";
import ProjectLayout from "@/layouts/ProjectLayout.astro";

// Generate a new path for every collection entry
export async function getStaticPaths() {
    const projects = await getCollection("projects");

    return projects.map((project) => {
        let slug = createSlug(project.data.title, project.data?.slug);
        return { params: { slug: slug }, props: { project } };
    });
}

interface Props {
    project: CollectionEntry<"projects">;
}

const { project } = Astro.props;

const { Content, headings } = await render(project);
---

<MainLayout title={project.data.title} layout="HIDE_ASIDE">
    {
        (project.data.code || project.data.externalLinks) && (
            <section slot="nav-sidebar">
                <ul class="m-4 w-max text-sm *:hover:underline">
                    <li>
                        {project.data.code && (
                            <a href={project.data.code}>CODE REPOSITORY</a>
                        )}
                    </li>

                    {project.data.externalLinks &&
                        project.data.externalLinks.map((link, index) => (
                            <li>
                                <a href={link}>EXTERNAL LINK {index + 1}</a>
                            </li>
                        ))}
                </ul>
            </section>
        )
    }

    <ProjectLayout project={project}>
        <article id="breakdown" class="prose">
            <hr />
            <Content />
            <hr />
        </article>
    </ProjectLayout>

    <!-- <section slot="nav-sidebar">
        <ul class="m-4 hover:underline">
            <li>
                <a href="">Overview</a>
            </li>
        </ul>
    </section> -->

    <TableOfContents headings={headings} slot="aside-sidebar" />
</MainLayout>
