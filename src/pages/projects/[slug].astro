---
import { getCollection, render, type CollectionEntry } from "astro:content";

import MainLayout from "@/layouts/MainLayout.astro";
import createSlug from "@/lib/createSlug";
import TableOfContents from "@/components/TableOfContents.astro";
import ProjectLayout from "@/layouts/ProjectLayout.astro";

// Generate a new path for every collection entry
export async function getStaticPaths() {
    const projects = await getCollection("projects");

    return projects.map((project) => {
        let slug = createSlug(project.data.title, project.data?.slug);
        return { params: { slug: slug }, props: { project } };
    });
}

interface Props {
    project: CollectionEntry<"projects">;
}

const { project } = Astro.props;

const { Content, headings } = await render(project);
---

<MainLayout title={project.data.title}>
    <section slot="nav-sidebar">
        <ul>
            <li>
                <a href="/">Overview</a>
            </li>
            <li>
                <a href="#breakdown">Breakdown</a>
            </li>
        </ul>
    </section>
    <ProjectLayout project={project}>
        <article id="breakdown" class="prose-custom prose-code:not-prose">
            <hr />
            <Content />
            <hr />
        </article>
    </ProjectLayout>
    <TableOfContents headings={headings} slot="aside-sidebar" />
</MainLayout>
